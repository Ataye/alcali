{% extends 'base.html' %}
{% load static %}
{% load getattribute %}
{% block css %}
{% endblock %}
{% block title %}SEARCH{% endblock %}
{% block content %}
  <div class="block-header">
    <h2>SEARCH</h2>
  </div>
  {% if minions %}
    <!-- Basic Examples -->
    <div class="row clearfix">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
          <div class="header">
            <h2>
              MINIONS SEARCH RESULTS
            </h2>
          </div>
          <div class="body">
            <div class="table-responsive">
              <table class="table table-striped table-hover dataTable js-exportable" style="width:100%">
                <thead>
                <tr>
                  <th>Minion Id</th>
                  <th style="white-space: nowrap">Highstate Conformity</th>
                  <th>Fqdn</th>
                  <th>OS</th>
                  <th>OS Version</th>
                  <th>Kernel</th>
                  <th>Last Job Runned</th>
                  <th>Last Highstate</th>
                </tr>
                </thead>
                <tbody>
                {% for minion in minions %}
                  <tr>
                    <td><a href="{% url 'minion_detail' minion_id=minion.minion_id %}">{{ minion.minion_id }}</a></td>
                    <td>{{ minion.conformity }}</td>
                    <td>{{ minion.loaded_grain|getattribute:'fqdn' }}</td>
                    <td>{{ minion.loaded_grain|getattribute:'os' }}</td>
                    <td>{{ minion.loaded_grain|getattribute:'oscodename' }}</td>
                    <td>{{ minion.loaded_grain|getattribute:'kernelrelease' }}</td>
                    <td>{{ minion.last_job.fun }}</td>
                    <td>{{ minion.last_highstate.alter_time }}</td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  {% if jobs %}
    <!-- Basic Examples -->
    <div class="row clearfix">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="card">
          <div class="header">
            <h2>
              JOBS SEARCH RESULTS
            </h2>
          </div>
          <div class="body">
            <div class="table-responsive">
              <table class="table table-striped table-hover dataTable js-exportable" style="width:100%">
                <thead>
                <tr>
                  <th>ID</th>
                  <th>Target</th>
                  <th>Function</th>
                  <th>Arguments</th>
                  <th>User</th>
                  <th>Status</th>
                  <th>Start Time</th>
                </tr>
                </thead>
                <tbody>
                {% for job in jobs %}
                  <tr>
                    <td><a href="{% url 'job_detail' jid=job.jid minion_id=job.id %}">{{ job.jid }}</a></td>
                    <td>{{ job.id }}</td>
                    <td>{{ job.fun }}</td>
                    <td>{% for arg in job.arguments %}{{ arg }} {% endfor %}</td>
                    <td>{{ job.user }}</td>
                    <td>{{ job.success_bool }}</td>
                    <td>{{ job.alter_time }}</td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
{% block js %}
  <script>
  let query = '{{ query }}';
    $(".js-exportable").DataTable();
    $("td:contains("+query+")").addClass('bg-pink');
  </script>
{% endblock %}
