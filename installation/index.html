



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A web based tool for monitoring and administrating Saltstack">
      
      
      
        <meta name="author" content="Matt Melquiond">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Installation - ALCALI</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installation" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="ALCALI" class="md-header-nav__button md-logo">
          
            <img src="../images/logo-144.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              ALCALI
            </span>
            <span class="md-header-nav__topic">
              
                Installation
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/latenighttales/alcali" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    latenighttales/alcali
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." class="md-tabs__link md-tabs__link--active">
        Home
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../views/overview/" class="md-tabs__link">
          Views
        </a>
      
    </li>
  

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../screenshots/" class="md-tabs__link">
          Screenshots
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="ALCALI" class="md-nav__button md-logo">
      
        <img src="../images/logo-144.png" width="48" height="48">
      
    </a>
    ALCALI
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/latenighttales/alcali" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    latenighttales/alcali
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../try/" title="Try it!" class="md-nav__link">
      Try it!
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../walkthrough/" title="Walkthrough" class="md-nav__link">
      Walkthrough
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Installation
      </label>
    
    <a href="./" title="Installation" class="md-nav__link md-nav__link--active">
      Installation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisite" class="md-nav__link">
    Prerequisite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-salt-master" class="md-nav__link">
    Preparing the salt master
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-access-and-master-job-store-configuration" class="md-nav__link">
    Database access and master job store configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salt-api" class="md-nav__link">
    Salt Api
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rest-endpoint-authentication" class="md-nav__link">
    Rest endpoint authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-token-auth-module" class="md-nav__link">
    Custom token auth module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-alcali" class="md-nav__link">
    Installing Alcali
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-docker" class="md-nav__link">
    Using Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#locally" class="md-nav__link">
    Locally
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-pip" class="md-nav__link">
    Using pip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-sources" class="md-nav__link">
    From Sources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../running/" title="Running Alcali" class="md-nav__link">
      Running Alcali
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Views
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Views
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../views/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/minions/" title="Minions" class="md-nav__link">
      Minions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/minion_details/" title="Minion Details" class="md-nav__link">
      Minion Details
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/jobs/" title="Jobs" class="md-nav__link">
      Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/job_detail/" title="Job Detail" class="md-nav__link">
      Job Detail
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/run/" title="Run" class="md-nav__link">
      Run
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/schedule/" title="Schedule" class="md-nav__link">
      Schedule
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/conformity/" title="Conformity" class="md-nav__link">
      Conformity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/keys/" title="Keys" class="md-nav__link">
      Keys
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/users/" title="Users" class="md-nav__link">
      Users
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../views/settings/" title="Settings" class="md-nav__link">
      Settings
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Screenshots
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Screenshots
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../screenshots/" title="" class="md-nav__link">
      
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contribute/" title="Contribute" class="md-nav__link">
      Contribute
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../licence/" title="Licence" class="md-nav__link">
      Licence
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisite" class="md-nav__link">
    Prerequisite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparing-the-salt-master" class="md-nav__link">
    Preparing the salt master
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-access-and-master-job-store-configuration" class="md-nav__link">
    Database access and master job store configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salt-api" class="md-nav__link">
    Salt Api
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rest-endpoint-authentication" class="md-nav__link">
    Rest endpoint authentication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-token-auth-module" class="md-nav__link">
    Custom token auth module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing-alcali" class="md-nav__link">
    Installing Alcali
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-docker" class="md-nav__link">
    Using Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#locally" class="md-nav__link">
    Locally
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-pip" class="md-nav__link">
    Using pip
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from-sources" class="md-nav__link">
    From Sources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h1>
<h2 id="prerequisite">Prerequisite<a class="headerlink" href="#prerequisite" title="Permanent link">&para;</a></h2>
<ul>
<li>A database (<strong>MariaDB/Mysql</strong> or <strong>Postgres</strong>) accessible to both your Salt master and Alcali.</li>
<li>the <a href="https://docs.saltstack.com/en/latest/ref/cli/salt-api.html#salt-api">Salt-Api</a> installed and accessible by Alcali.</li>
</ul>
<p><img alt="structure" src="../images/structure.png" /></p>
<h2 id="preparing-the-salt-master">Preparing the salt master<a class="headerlink" href="#preparing-the-salt-master" title="Permanent link">&para;</a></h2>
<h3 id="database-access-and-master-job-store-configuration">Database access and master job store configuration<a class="headerlink" href="#database-access-and-master-job-store-configuration" title="Permanent link">&para;</a></h3>
<p>The salt master needs to store its jobs on the chosen database.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Don't forget to install database connectors:</p>
<ul>
<li><code>python-mysqldb/python3-mysqldb</code> for MySQL/MariaDB</li>
<li><code>python-psycopg2/python3-psycopg2</code> for Postgres</li>
</ul>
</div>
<details><summary>MySQL/MariaDB schema and configuration example</summary>
<p>

<div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">DATABASE</span>  <span class="o">`</span><span class="n">salt</span><span class="o">`</span>
  <span class="k">DEFAULT</span> <span class="nb">CHARACTER</span> <span class="k">SET</span> <span class="n">utf8</span>
  <span class="k">DEFAULT</span> <span class="k">COLLATE</span> <span class="n">utf8_general_ci</span><span class="p">;</span>

<span class="n">USE</span> <span class="o">`</span><span class="n">salt</span><span class="o">`</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `jids`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">jids</span><span class="o">`</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">jids</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">jid</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="k">load</span><span class="o">`</span> <span class="n">mediumtext</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="n">jid</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">jid</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `salt_returns`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">salt_returns</span><span class="o">`</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">salt_returns</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">fun</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">jid</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="k">return</span><span class="o">`</span> <span class="n">mediumtext</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">success</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">full_ret</span><span class="o">`</span> <span class="n">mediumtext</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">alter_time</span><span class="o">`</span> <span class="k">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
  <span class="k">KEY</span> <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="o">`</span><span class="n">jid</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">jid</span><span class="o">`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="o">`</span><span class="n">fun</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">fun</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table `salt_events`</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">salt_events</span><span class="o">`</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">salt_events</span><span class="o">`</span> <span class="p">(</span>
<span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="o">`</span><span class="n">tag</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="o">`</span><span class="k">data</span><span class="o">`</span> <span class="n">mediumtext</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="o">`</span><span class="n">alter_time</span><span class="o">`</span> <span class="k">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
<span class="o">`</span><span class="n">master_id</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
<span class="k">KEY</span> <span class="o">`</span><span class="n">tag</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">tag</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</pre></div>



Salt master configuration example:


<div class="codehilite"><pre><span></span><span class="nt">event_return</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">mysql</span><span class="p p-Indicator">]</span>
<span class="nt">master_job_cache</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="nt">mysql.host</span><span class="p">:</span> <span class="s">&#39;db&#39;</span>
<span class="nt">mysql.user</span><span class="p">:</span> <span class="s">&#39;alcali&#39;</span>
<span class="nt">mysql.pass</span><span class="p">:</span> <span class="s">&#39;alcali&#39;</span>
<span class="nt">mysql.db</span><span class="p">:</span> <span class="s">&#39;salt&#39;</span>
<span class="nt">mysql.port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3306</span>
</pre></div>



</p>
</details>

<details><summary>Postgres commands and configuration example</summary>
<p>

<div class="codehilite"><pre><span></span><span class="n">psql</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span>
<span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">salt</span> <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="s1">&#39;salt&#39;</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">salt</span> <span class="k">WITH</span> <span class="k">OWNER</span> <span class="n">salt</span><span class="p">;</span>
<span class="n">EOF</span>

<span class="n">psql</span> <span class="o">-</span><span class="n">h</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">U</span> <span class="n">salt</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span>
<span class="c1">--</span>
<span class="c1">-- Table structure for table &#39;jids&#39;</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">jids</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">jids</span> <span class="p">(</span>
  <span class="n">jid</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="k">load</span>  <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table &#39;salt_returns&#39;</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">salt_returns</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">salt_returns</span> <span class="p">(</span>
  <span class="n">fun</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">jid</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">return</span>    <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">full_ret</span>  <span class="nb">text</span><span class="p">,</span>
  <span class="n">id</span>        <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">success</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">alter_time</span>   <span class="k">TIMESTAMP</span> <span class="k">WITH</span> <span class="n">TIME</span> <span class="k">ZONE</span> <span class="k">DEFAULT</span> <span class="n">now</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_salt_returns_id</span> <span class="k">ON</span> <span class="n">salt_returns</span> <span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_salt_returns_jid</span> <span class="k">ON</span> <span class="n">salt_returns</span> <span class="p">(</span><span class="n">jid</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_salt_returns_fun</span> <span class="k">ON</span> <span class="n">salt_returns</span> <span class="p">(</span><span class="n">fun</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_salt_returns_updated</span> <span class="k">ON</span> <span class="n">salt_returns</span> <span class="p">(</span><span class="n">alter_time</span><span class="p">);</span>

<span class="c1">--</span>
<span class="c1">-- Table structure for table &#39;salt_events&#39;</span>
<span class="c1">--</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">salt_events</span><span class="p">;</span>
<span class="k">DROP</span> <span class="n">SEQUENCE</span> <span class="k">IF</span> <span class="k">EXISTS</span> <span class="n">seq_salt_events_id</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="n">SEQUENCE</span> <span class="n">seq_salt_events_id</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">salt_events</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">BIGINT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span> <span class="k">DEFAULT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;seq_salt_events_id&#39;</span><span class="p">),</span>
    <span class="n">tag</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">data</span> <span class="nb">text</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">alter_time</span> <span class="k">TIMESTAMP</span> <span class="k">WITH</span> <span class="n">TIME</span> <span class="k">ZONE</span> <span class="k">DEFAULT</span> <span class="n">NOW</span><span class="p">(),</span>
    <span class="n">master_id</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_salt_events_tag</span> <span class="k">on</span> <span class="n">salt_events</span> <span class="p">(</span><span class="n">tag</span><span class="p">);</span>

<span class="n">EOF</span>
</pre></div>



Salt master configuration example:


<div class="codehilite"><pre><span></span><span class="nt">event_return</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">postgres</span><span class="p p-Indicator">]</span>
<span class="nt">master_job_cache</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postgres</span> 
<span class="nt">returner.postgres.host</span><span class="p">:</span> <span class="s">&#39;db&#39;</span>
<span class="nt">returner.postgres.user</span><span class="p">:</span> <span class="s">&#39;alcali&#39;</span>
<span class="nt">returner.postgres.passwd</span><span class="p">:</span> <span class="s">&#39;alcali&#39;</span>
<span class="nt">returner.postgres.db</span><span class="p">:</span> <span class="s">&#39;salt&#39;</span>
<span class="nt">returner.postgres.port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5432</span>
</pre></div>



</p>
</details>

<p>By default, jobs are only kept for 24 hours. Set <code>keep_jobs: 0</code> to disable the cache cleaner (see <a href="https://docs.saltstack.com/en/latest/topics/jobs/job_cache.html#managing-the-job-cache">managing the job cache</a>).</p>
<p>Returners provide a way to archive old jobs. Refer to Salt <a href="https://docs.saltstack.com/en/latest/ref/returners/all/salt.returners.mysql.html#module-salt.returners.mysql">MySQL</a> or <a href="https://docs.saltstack.com/en/latest/ref/returners/all/salt.returners.postgres.html">Postgres</a> returner documentation for more information.</p>
<h3 id="salt-api">Salt Api<a class="headerlink" href="#salt-api" title="Permanent link">&para;</a></h3>
<p>Salt master configuration example:</p>
<div class="codehilite"><pre><span></span><span class="nt">rest_cherrypy</span><span class="p">:</span>
  <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
  <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span>
  <span class="nt">debug</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
  <span class="nt">ssl_crt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/pki/tls/certs/localhost.crt</span>
  <span class="nt">ssl_key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/pki/tls/certs/localhost.key</span>
</pre></div>


<p>Install instruction example (On Debian 9 using Salt python3 version):</p>
<div class="codehilite"><pre><span></span>apt-get install -y salt-api python3-openssl
salt-call --local tls.create_self_signed_cert <span class="nv">cacert_path</span><span class="o">=</span><span class="s1">&#39;/etc/pki&#39;</span>
</pre></div>


<p>Please refer to Salt <a href="https://docs.saltstack.com/en/latest/ref/netapi/all/salt.netapi.rest_cherrypy.html#a-rest-api-for-salt">rest_cherrypy</a> documentation for more infos on how to setup the salt-api.</p>
<h3 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h3>
<p>Alcali provide two authentication methods:</p>
<ul>
<li>a <strong>rest endpoint</strong> on alcali.</li>
<li>a custom token based <strong>auth module</strong> for Salt.</li>
</ul>
<h4 id="rest-endpoint-authentication">Rest endpoint authentication<a class="headerlink" href="#rest-endpoint-authentication" title="Permanent link">&para;</a></h4>
<p>To use the rest endpoint authentication, the salt master must be able to connect to alcali.</p>
<p>Set <code>SALT_AUTH=rest</code> in the <a href="../configuration/">env file</a> and use the <a href="https://docs.saltstack.com/en/latest/ref/auth/all/salt.auth.rest.html">rest external auth</a> in the salt master configuration.</p>
<p>the <code>^url</code> key is how the salt master connect to alcali.</p>
<div class="codehilite"><pre><span></span><span class="nt">external_auth</span><span class="p">:</span>
  <span class="nt">rest</span><span class="p">:</span>
    <span class="nt">^url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://127.0.0.1:8000/api/token/verify/</span>
    <span class="nt">admin</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">.*</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;@runner&#39;</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;@wheel&#39;</span>
</pre></div>


<h4 id="custom-token-auth-module">Custom token auth module<a class="headerlink" href="#custom-token-auth-module" title="Permanent link">&para;</a></h4>
<p>Set <code>SALT_AUTH=rest</code> in the <a href="../configuration/">env file</a></p>
<p>You can get the Alcali auth module <a href="https://raw.githubusercontent.com/latenighttales/alcali/2019.2/docker/saltconfig/salt/auth/alcali.py">here</a></p>
<p>Place it on the salt filesystem (for example: <code>/srv/salt/auth</code>) and add it to your Salt master configuration:</p>
<div class="codehilite"><pre><span></span><span class="nt">auth_dirs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">/srv/salt/auth</span><span class="p p-Indicator">]</span>
</pre></div>


<p>External auth example:</p>
<div class="codehilite"><pre><span></span><span class="nt">external_auth</span><span class="p">:</span>
  <span class="nt">alcali</span><span class="p">:</span>
    <span class="nt">admin</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">.*</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;@runner&#39;</span>
      <span class="p p-Indicator">-</span> <span class="s">&#39;@wheel&#39;</span>
</pre></div>


<p>Don't forget to run <code>salt-run saltutil.sync_all</code> on the salt master.</p>
<p>See <a href="https://docs.saltstack.com/en/latest/topics/eauth/index.html#acl-eauth">Saltstack external auth system</a> for more infos.</p>
<p>Tokens can be managed using the <a href="../running/">alcali</a> command or directly in the <a href="../views/users/">web interface</a>.</p>
<h2 id="installing-alcali">Installing Alcali<a class="headerlink" href="#installing-alcali" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Alcali follow Salt major and minor versioning.</p>
<p>If you are using <code>2019.2.X</code> Salt version, you should install <code>2019.2.X</code> Alcali version.</p>
</div>
<p>There are 3 different ways to install Alcali manually:</p>
<ul>
<li>Using a docker container</li>
<li>From PyPI</li>
<li>From Sources</li>
</ul>
<p>Otherwise, there is a <a href="https://github.com/latenighttales/alcali-formula">Formula</a> to install it.</p>
<h4 id="using-docker">Using Docker<a class="headerlink" href="#using-docker" title="Permanent link">&para;</a></h4>
<p>The official <a href="https://hub.docker.com/r/latenighttales/alcali">Docker image</a> for Alcali comes with all dependencies pre-installed and ready-to-use with the latest version published on PyPI. Pull it with:</p>
<div class="codehilite"><pre><span></span>docker pull latenighttales/alcali:2019.2.1
</pre></div>


<p>The <code>alcali</code> executable is provided as an entrypoint.</p>
<h3 id="locally">Locally<a class="headerlink" href="#locally" title="Permanent link">&para;</a></h3>
<p>To install Alcali locally, you'll need to install database connectors dependencies:</p>
<p>For Debian based distribution:</p>
<div class="codehilite"><pre><span></span># For postgres database
apt install libpq-dev gcc
# For mariadb database
apt install libmariadbclient-dev gcc
</pre></div>


<p>For Red-Hat based distribution:</p>
<div class="codehilite"><pre><span></span># For postgres database
yum install libpq-devel gcc
# For mariadb database
yum install mysql-devel gcc
</pre></div>


<h4 id="using-pip">Using pip<a class="headerlink" href="#using-pip" title="Permanent link">&para;</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>We strongly recommend installing Alcali in a <a href="https://docs.python.org/3/library/venv.html">virtualenv</a>.</p>
<p>Example:</p>
<p><code>python3 -m venv $HOME/.venv</code></p>
<p><code>source $HOME/.venv/bin/activate</code></p>
</div>
<p>Simply do:</p>
<div class="codehilite"><pre><span></span>pip install --user alcali
</pre></div>


<p>And for mysql/mariadb:</p>
<div class="codehilite"><pre><span></span>pip install --user mysqlclient
</pre></div>


<p>or for postgres:</p>
<div class="codehilite"><pre><span></span>pip install --user psycopg2
</pre></div>


<h4 id="from-sources">From Sources<a class="headerlink" href="#from-sources" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>git clone https://github.com/latenighttales/alcali.git
git checkout 2019.2 # or 2018.3
pip install --user . 
</pre></div>


<p>And for mysql/mariadb:</p>
<div class="codehilite"><pre><span></span>pip install --user mysqlclient
</pre></div>


<p>or for postgres:</p>
<div class="codehilite"><pre><span></span>pip install --user psycopg2
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">

        <!-- Link to previous page -->
        
          <a href="../walkthrough/"
              title="Walkthrough"
              class="md-flex md-footer-nav__link md-footer-nav__link--prev"
              rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back
                    md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch
                  md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Walkthrough
              </span>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          <a href="../configuration/"
              title="Configuration"
              class="md-flex md-footer-nav__link md-footer-nav__link--next"
              rel="next">
            <div class="md-flex__cell md-flex__cell--stretch
                  md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Configuration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward
                    md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 All rights reserved
          </div>
        
      </div>
      <!-- Social links -->
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/latenighttales/alcali" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>